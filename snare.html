<!DOCTYPE html>

<html>
  <head>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.2.0/socket.io.js"></script>
    <style>
      *,
      *::before,
      *::after {
        box-sizing: border-box;
      }

      .main {
        background-color: grey;
        margin: 0;
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
      }
    </style>
  </head>

  <body>
    <div id="main" class="main">
      <div class="snare" id="snare"></div>

      <audio
        id="snare_sound"
        src="https://cdn.glitch.global/1ea1ca4a-613c-41b7-9fdc-6415548f138f/snare.wav?v=1668732205484"
      ></audio>
      <audio id="piano_sound" src=""></audio>
    </div>
    <script>
      const KEYS = ["z", "s", "x", "d", "c", "v", "g", "b", "h", "n", "j", "m"];
      const piano_source = [
        "https://cdn.glitch.global/1ea1ca4a-613c-41b7-9fdc-6415548f138f/C.mp3?v=1668737746257",
        "https://cdn.glitch.global/1ea1ca4a-613c-41b7-9fdc-6415548f138f/Db.mp3?v=1668737748784",
        "https://cdn.glitch.global/1ea1ca4a-613c-41b7-9fdc-6415548f138f/D.mp3?v=1668737747570",
        "https://cdn.glitch.global/1ea1ca4a-613c-41b7-9fdc-6415548f138f/Eb.mp3?v=1668737751209",
        "https://cdn.glitch.global/1ea1ca4a-613c-41b7-9fdc-6415548f138f/E.mp3?v=1668737749979",
        "https://cdn.glitch.global/1ea1ca4a-613c-41b7-9fdc-6415548f138f/F.mp3?v=1668737752455",
        "https://cdn.glitch.global/1ea1ca4a-613c-41b7-9fdc-6415548f138f/Gb.mp3?v=1668737754977",
        "https://cdn.glitch.global/1ea1ca4a-613c-41b7-9fdc-6415548f138f/G.mp3?v=1668737753716",
        "https://cdn.glitch.global/1ea1ca4a-613c-41b7-9fdc-6415548f138f/Ab.mp3?v=1668737757406",
        "https://cdn.glitch.global/1ea1ca4a-613c-41b7-9fdc-6415548f138f/A.mp3?v=1668737756198",
        "https://cdn.glitch.global/1ea1ca4a-613c-41b7-9fdc-6415548f138f/Bb.mp3?v=1668737759810",
        "https://cdn.glitch.global/1ea1ca4a-613c-41b7-9fdc-6415548f138f/B.mp3?v=1668737758611",
      ];
      //init socket
      var socket = io();

      //connect to your server address
      socket.connect("https://collaborative-piano.glitch.me/:3000");

      //when a text is recieved...
      socket.on("key", (d) => {
        const keyIndex = KEYS.indexOf(d.key);
        console.log("receiving: " + d.key);
        piano(piano_source[keyIndex]);
      });

      function piano(key) {
        const noteAudio = document.getElementById(piano_sound);
        noteAudio.src = key;
        noteAudio.load();
        noteAudio.currentTime = 0;
        noteAudio.play();
      }

      //figure out who this client is, this is for styling in the chatting application
      var me;
      var address = window.location.href;
      var who = address.substring(address.lastIndexOf("/") + 1);
      var recordedNotes = [];
      var playingRecording = false;
      var recording = false;

      if (who === "piano") {
        console.log("piano");
        me = {
          id: "piano",
          img: piano,
        };
      }
      if (who === "snare") {
        console.log("snare");
        me = {
          id: "snare",
          img: snare,
        };
      }
      if (who === "tambourine") {
        console.log("tambourine");
        var element = document.getElementById("piano");
        element.style.display = "none";
        me = {
          id: "tambourine",
          img: tambourine,
        };
      }
    </script>
  </body>
</html>
