<!DOCTYPE html>

<html>
  <head>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.2.0/socket.io.js"></script>
    <style>
      *,
      *::before,
      *::after {
        box-sizing: border-box;
      }

      .main {
        background-color: grey;
        margin: 0;
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
      }
    </style>
  </head>

  <body>
    <div id="main" class="main">
      <div class="snare" id="snare"></div>

      <audio
        id="snare_sound"
        src="https://cdn.glitch.global/1ea1ca4a-613c-41b7-9fdc-6415548f138f/snare.wav?v=1668732205484"
      ></audio>
      

      <audio
        id="C"
        src="https://cdn.glitch.global/1ea1ca4a-613c-41b7-9fdc-6415548f138f/C.mp3?v=1668737746257"
      ></audio>
      <audio
        id="Db"
        src="https://cdn.glitch.global/1ea1ca4a-613c-41b7-9fdc-6415548f138f/Db.mp3?v=1668737748784"
      ></audio>
      <audio
        id="D"
        src="https://cdn.glitch.global/1ea1ca4a-613c-41b7-9fdc-6415548f138f/D.mp3?v=1668737747570"
      ></audio>
      <audio
        id="Eb"
        src="https://cdn.glitch.global/1ea1ca4a-613c-41b7-9fdc-6415548f138f/Eb.mp3?v=1668737751209"
      ></audio>
      <audio
        id="E"
        src="https://cdn.glitch.global/1ea1ca4a-613c-41b7-9fdc-6415548f138f/E.mp3?v=1668737749979"
      ></audio>
      <audio
        id="F"
        src="https://cdn.glitch.global/1ea1ca4a-613c-41b7-9fdc-6415548f138f/F.mp3?v=1668737752455"
      ></audio>
      <audio
        id="Gb"
        src="https://cdn.glitch.global/1ea1ca4a-613c-41b7-9fdc-6415548f138f/Gb.mp3?v=1668737754977"
      ></audio>
      <audio
        id="G"
        src="https://cdn.glitch.global/1ea1ca4a-613c-41b7-9fdc-6415548f138f/G.mp3?v=1668737753716"
      ></audio>
      <audio
        id="Ab"
        src="https://cdn.glitch.global/1ea1ca4a-613c-41b7-9fdc-6415548f138f/Ab.mp3?v=1668737757406"
      ></audio>
      <audio
        id="A"
        src="https://cdn.glitch.global/1ea1ca4a-613c-41b7-9fdc-6415548f138f/A.mp3?v=1668737756198"
      ></audio>
      <audio
        id="Bb"
        src="https://cdn.glitch.global/1ea1ca4a-613c-41b7-9fdc-6415548f138f/Bb.mp3?v=1668737759810"
      ></audio>
      <audio
        id="B"
        src="https://cdn.glitch.global/1ea1ca4a-613c-41b7-9fdc-6415548f138f/B.mp3?v=1668737758611"
      ></audio>
    </div>

    <script>
      //init socket
      var socket = io();

      //connect to your server address
      socket.connect("https://collaborative-piano.glitch.me/:3000");

      //when a text is recieved...
      socket.on("key", (d) => {
        console.log("receiving: " + d.key);

        if (d.whiteKeyIndex > -1) {
          piano(whiteKeys[d.whiteKeyIndex]);
        }
        if (d.blackKeyIndex > -1) {
          piano(blackKeys[d.blackKeyIndex]);
        }
      });
      
      const WHITE_KEYS = ["z", "x", "c", "v", "b", "n", "m"];
      const BLACK_KEYS = ["s", "d", "g", "h", "j"];
      
      const key = e.key;
      const whiteKeyIndex = WHITE_KEYS.indexOf(key);
      const blackKeyIndex = BLACK_KEYS.indexOf(key);

      function piano(key) {
        const noteAudio = document.getElementById(key.dataset.note);
        noteAudio.currentTime = 0;
        noteAudio.play();
      }
      //figure out who this client is, this is for styling in the chatting application
      var me;
      var address = window.location.href;
      var who = address.substring(address.lastIndexOf("/") + 1);
      var recordedNotes = [];
      var playingRecording = false;
      var recording = false;

      if (who === "piano") {
        console.log("piano");
        me = {
          id: "piano",
          img: piano,
        };
      }
      if (who === "snare") {
        console.log("snare");
        me = {
          id: "snare",
          img: snare,
        };
      }
      if (who === "tambourine") {
        console.log("tambourine");
        var element = document.getElementById("piano");
        element.style.display = "none";
        me = {
          id: "tambourine",
          img: tambourine,
        };
      }
    </script>
  </body>
</html>
